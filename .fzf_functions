# FZF Functions
# https://github.com/junegunn/fzf/wiki/examples


# Help
alias fzh='echo "$FZHELP"'
FZHELP=' fd: recursive change directory\n fdw: change to working directory\n fo: open file\n fow: open file from working directory\n fa: recursively open file in atom\n fmw: move file recursively to working directory\n fmr: move file recursively within directory'


# Fuzzy Change Directory (only within directories situated recursively below current context)
fd() {
  local dir
  dir=$(find . -type d | fzf) &&
  cd "$dir" && ls -a
}

# Fuzzy Change Directory (from common working directory)
fdw() {
  local dir
  dir=$(find $TEACH $PROF $ADMIN $PROJ -type d | fzf) &&
  cd "$dir" && ls -a
}


# Fuzzy Open File (only files nested recursively within current context)
fo() {
  local file
  file=$(find . -type f | fzf --preview 'cat {}' --delimiter / --with-nth -1) &&
  open "$file"
}

# Fuzzy Open File (from common working directory)
fow() {
  local file
  file=$(find $TEACH $PROF $ADMIN $PROJ -type f | fzf --preview 'cat {}' --delimiter / --with-nth -1) &&
  open "$file"
}


# Fuzzy Open File in Atom (only files nested recursively within current context)
fa() {
  local file
  file=$(find . -type f | fzf --preview 'cat {}') &&
  a "$file"
}


# Fuzzy Move File to Common Working Directories
fmw() {
  local file
  file=$(find . -type f | fzf --preview 'cat {}') &&
  local dir
  dir=$(find $TEACH $PROF $ADMIN $PROJ -type d | fzf)
  mv "$file" "$dir"
}

# Fuzzy Move File to Common Kitob Khona directories
## NOT WORKING
fmk() {
  local file
  file=$(find . -type f | fzf --preview 'cat {}') &&
  local dir
  dir=$(find $KITOB"Secondary Literature/Pickett library" $KITOB"Secondary Literature/Unsorted Secondary Literature" $KITOB"Primary Sources" -type d | fzf)
  mv "$file" "$dir"
}


# Fuzzy Move File (recursively within directory)
fmr() {
  local file
  file=$(find . -type f | fzf --preview 'cat {}') &&
  local dir
  dir=$(find . -type d | fzf)
  mv "$file" "$dir"
}



# Fuzzy search file contents (current folder)
## NOT WORKING
alias fc="grep --line-buffered --color=never -r "" * | fzf"


f() {
    sels=( "${(@f)$(fd "${fd_default[@]}" "${@:2}"| fzf)}" )
    test -n "$sels" && print -z -- "$1 ${sels[@]:q:q}"
}


# Fuzzy Create File (in working folder)
## NOT  WORKING
ftf() {
  read -p "File name: " file
  local dir
  dir=$(find $KITOB"Secondary Literature/Pickett library" $KITOB"Secondary Literature/Unsorted Secondary Literature" $KITOB"Primary Sources" -type d | fzf)
  touch $dir/$file
  open $dir/$file
}
